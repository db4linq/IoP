// Generated by CoffeeScript 1.10.0
(function() {
  var change_information_general_settings_responsible, change_wizard_general_settings_responsible, create_new_general_settings_responsible, delete_general_settings_responsible, get_current_notification_message, get_day_night, get_general_settings_responsibles, get_notification_message_content, get_notification_messages, modify_day_night, modify_plant_durations, submit_notification_message;

  get_notification_messages = function(callback) {
    var request;
    console.log('TEST!');
    request = $.ajax({
      url: '/get/notification/message/names',
      method: 'POST',
      data: {}
    });
    return request.done(function(msg) {
      var i, len, message, name, tag, uuid;
      msg = JSON.parse(msg);
      console.log(msg);
      $('.dropdown.notification_message > .menu').emtpy;
      for (i = 0, len = msg.length; i < len; i++) {
        message = msg[i];
        uuid = message['uuid'];
        name = message['name'];
        tag = "<div class='item' data-value='" + uuid + "'>" + name + "</div>";
        console.log(tag);
        $('.dropdown.notification_message > .menu').append(tag);
      }
      return callback('finished');
    });
  };

  window.get_notification_messages = get_notification_messages;

  get_current_notification_message = function(that) {
    var request;
    if (that !== void 0) {
      $(that).addClass('disabled');
      $(that).addClass('loading');
    }
    request = $.ajax({
      url: '/get/plant/notification/message',
      method: 'POST'
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      $('.notification_message_content').val(msg.message);
      $('.ui.selection.dropdown').dropdown('set selected', msg.uuid);
      if (that !== void 0) {
        $(that).removeClass('disabled');
        return $(that).removeClass('loading');
      }
    });
  };

  window.get_current_notification_message = get_current_notification_message;

  get_notification_message_content = function(uuid) {
    var request;
    request = $.ajax({
      url: '/get/notification/message/content',
      method: 'POST',
      data: {
        'uuid': uuid
      }
    });
    return request.done(function(msg) {
      msg = JSON.parse(msg);
      return $('.notification_message_content').val(msg);
    });
  };

  window.get_notification_message_content = get_notification_message_content;

  submit_notification_message = function(that, message, name, uuid, responsible) {
    var data, request;
    if (responsible == null) {
      responsible = true;
    }
    $(that).addClass('disabled');
    $(that).addClass('loading');
    data = {
      'message': message,
      'name': name
    };
    data.responsible = responsible;
    if (uuid === !null) {
      data.uuid = uuid;
    }
    request = $.ajax({
      url: '/submit/notification/message',
      method: 'POST',
      data: data
    });
    return request.done(function(msg) {
      msg = JSON.parse(msg);
      if (msg['code'] !== 'ok') {
        $('.alert').html = msg['code'];
      }
      $(that).removeClass('disabled');
      return $(that).removeClass('loading');
    });
  };

  window.submit_notification_message = submit_notification_message;

  get_general_settings_responsibles = function() {
    var request;
    request = $.ajax({
      url: '/get/responsibles',
      method: 'POST'
    });
    return request.done(function(msg) {
      var i, len, person, replace, results, tab;
      msg = JSON.parse(msg);
      $(".ui.middle.aligned.divided.list").html('');
      results = [];
      for (i = 0, len = msg.length; i < len; i++) {
        person = msg[i];
        tab = '<div class="item"> <div class="right floated content"> <div class="ui small basic icon buttons"> <button class="ui button"> <div class="ui radio checkbox"> <input type="radio" name="wizard" [[checked]] onChange="change_wizard_general_settings_responsible(this, \'[[identifier]]\')"> <label><i class="wizard icon"></i> </label> </div> </button> <button onclick="$(\'.[[identifier]]\').accordion(\'toggle\', 0);" class="ui button"><i class="edit icon"></i> </button> <button class="ui button" onclick="delete_general_settings_responsible(\'[[identifier]]\')"><i class="remove icon"></i> </button> </div> </div><img src="https://source.unsplash.com/category/nature" class="ui avatar image"> <div class="content">[[name]]</div> <div class="ui accordion [[identifier]]"> <div style="height:0;padding:0" class="title"></div> <div style="margin-top:1%" class="content"> <div class="ui grid"> <div class="two column row relaxed"> <div style="margin-bottom:1%" class="column"> <div class="ui fluid left icon input"> <input type="text" class="name-[[identifier]]" placeholder="Name" value="[[name]]"><i class="tag icon"></i> </div> </div> <div class="column"> <div class="ui fluid left icon input"> <input type="text" class="email-[[identifier]]" placeholder="EMail" value="[[email]]"><i class="mail icon"></i> </div> </div> </div> </div> <div class="ui two buttons"> <div class="ui basic button fluid green" onclick="change_information_general_settings_responsible(this, \'[[identifier]]\')">Apply</div> <div class="ui basic button fluid red">Reset</div> </div> </div> </div> <script type="text/javascript"> </script> </div>';
        tab = tab.replace(/\[\[identifier\]\]/g, person.uuid);
        tab = tab.replace(/\[\[name\]\]/g, person.name);
        tab = tab.replace(/\[\[email\]\]/g, person.email);
        if (person.wizard === false) {
          replace = '';
        } else {
          replace = 'checked';
        }
        tab = tab.replace(/\[\[checked\]\]/g, replace);
        results.push($(".ui.middle.aligned.divided.list").append(tab));
      }
      return results;
    });
  };

  window.get_general_settings_responsibles = get_general_settings_responsibles;

  delete_general_settings_responsible = function(uuid) {
    var request;
    request = $.ajax({
      url: '/remove/responsible',
      method: 'POST',
      data: {
        uuid: uuid
      }
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      console.log(msg);
      get_general_settings_responsibles();
    });
  };

  window.delete_general_settings_responsible = delete_general_settings_responsible;

  change_wizard_general_settings_responsible = function(that, uuid) {
    var request;
    if (that.checked) {
      request = $.ajax({
        url: '/change/responsible/wizard',
        method: 'POST',
        data: {
          uuid: uuid
        }
      });
      request.done(function(msg) {
        msg = JSON.parse(msg);
        console.log(msg);
        get_general_settings_responsibles();
      });
    }
  };

  window.change_wizard_general_settings_responsible = change_wizard_general_settings_responsible;

  change_information_general_settings_responsible = function(that, uuid) {
    var email, name, request;
    $(that).addClass('disabled');
    $(that).addClass('loading');
    name = $(".name-" + uuid).val();
    email = $(".email-" + uuid).val();
    request = $.ajax({
      url: '/change/responsible',
      method: 'POST',
      data: {
        uuid: uuid,
        name: name,
        email: email
      }
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      console.log(msg);
      $(that).removeClass('disabled');
      $(that).removeClass('loading');
      get_general_settings_responsibles();
    });
  };

  window.change_information_general_settings_responsible = change_information_general_settings_responsible;

  create_new_general_settings_responsible = function() {
    var email, name, request;
    name = $(".new.name").val();
    email = $(".new.email").val();
    request = $.ajax({
      url: '/create/responsible/none',
      method: 'POST',
      data: {
        name: name,
        email: email,
        wizard: 'no'
      }
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      console.log(msg);
      $(".new.name").val('');
      $(".new.email").val('');
      return get_general_settings_responsibles();
    });
  };

  window.create_new_general_settings_responsible = create_new_general_settings_responsible;

  modify_plant_durations = function(that) {
    var request;
    $(that).addClass('disabled');
    $(that).addClass('loading');
    request = $.ajax({
      url: '/change/plant/intervals',
      method: 'POST',
      data: {
        notification: $("#flat-slider-general-interval").slider("option", "value"),
        connection: $("#flat-slider-dead-interval").slider("option", "value"),
        non_persistant: $("#flat-slider-non-persistant-interval").slider("option", "value")
      }
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      $(that).removeClass('disabled');
      return $(that).removeClass('loading');
    });
  };

  window.modify_plant_durations = modify_plant_durations;

  get_day_night = function() {
    var request;
    request = $.ajax({
      url: '/get/day_night',
      method: 'POST'
    });
    request.done(function(msg) {
      var start, stop;
      msg = JSON.parse(msg);
      if (msg.ledbar) {
        $('.field.ledbar > .ui.checkbox > input').prop('checked', true);
      }
      if (msg.display) {
        $('.field.display > .ui.checkbox > input').prop('checked', true);
      }
      if (msg.generalleds) {
        $('.field.generalleds > .ui.checkbox > input').prop('checked', true);
      }
      if (msg.notification) {
        $('.field.notification > .ui.checkbox > input').prop('checked', true);
      }
      start = msg.start.toString();
      if (start.length === 3) {
        start = start.slice(0, 1);
      } else {
        start = start.slice(0, 2);
      }
      stop = msg.stop.toString();
      if (stop.length === 3) {
        stop = stop.slice(0, 1);
      } else {
        stop = stop.slice(0, 2);
      }
      return $("#flat-slider-time-interval").slider({
        max: 24,
        min: 0,
        range: true,
        values: [parseInt(start), parseInt(stop)]
      }).slider("pips", {
        first: "pip",
        last: "pip"
      });
    });
  };

  window.get_day_night = get_day_night;

  modify_day_night = function(that) {
    var request, time;
    $(that).addClass('disabled');
    $(that).addClass('loading');
    time = $("#flat-slider-time-interval").slider("option", "values");
    request = $.ajax({
      url: '/change/day_night',
      method: 'POST',
      data: {
        stop: parseInt(time[1].toString() + '00'),
        start: parseInt(time[0].toString() + '00'),
        ledbar: $('.field.ledbar > .ui.checkbox > input').prop('checked'),
        display: $('.field.display > .ui.checkbox > input').prop('checked'),
        generalleds: $('.field.generalleds > .ui.checkbox > input').prop('checked'),
        notification: $('.field.notification > .ui.checkbox > input').prop('checked')
      }
    });
    request.done(function(msg) {
      msg = JSON.parse(msg);
      $(that).removeClass('disabled');
      return $(that).removeClass('loading');
    });
  };

  window.modify_day_night = modify_day_night;

}).call(this);

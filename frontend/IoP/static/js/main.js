// Generated by CoffeeScript 1.10.0
(function() {
  var getCurrentPlant, initLineGraph, initSetTab, sg_nsps;

  getCurrentPlant = function() {
    var request;
    request = $.ajax({
      url: '/get/current/plant',
      method: 'POST',
      async: false,
      data: {}
    });
    request.done(function(msg) {});
    request.fail(function(jqXHR, textStatus) {
      $('section.mainContent').html('Request failed:' + textStatus);
    });
    return request.responseText;
  };

  initLineGraph = function(graphName) {
    var sensordata;
    sensordata = $.ajax({
      url: '/get/plant/sensor/dataset',
      method: 'POST',
      data: {}
    });
    sensordata.done(function(sensordatamsg) {
      var data, g, i, len, ref, sensordataset;
      sensordataset = [];
      ref = JSON.parse(sensordatamsg);
      for (i = 0, len = ref.length; i < len; i++) {
        data = ref[i];
        sensordataset.push([new Date(data['dt'] * 1000), data['v']]);
      }
      smoothPlotter.smoothing = 0.33;
      return g = new Dygraph(document.getElementById("graph"), sensordataset, {
        labels: ['time', graphName],
        plotter: smoothPlotter,
        legend: 'always',
        animatedZooms: true
      });
    });
  };

  window.initLineGraph = initLineGraph;

  initSetTab = function(tabName) {
    $('div.menu.mainMenu').children('.' + tabName).addClass('active');
  };

  window.initSetTab = initSetTab;

  sg_nsps = function() {};

  $(function() {
    $('div.menu.mainMenu a').click(function(e) {
      $(this).parent().children('.active').removeClass('active');
      $(this).addClass('active');
    });
    $('a.item.global_settings').click(function(e) {
      var request;
      request = $.ajax({
        url: '/get/general/settings',
        method: 'POST',
        data: {}
      });
      request.done(function(msg) {
        $('section.mainContent').html(msg);
        window.history.pushState({}, '', '/global/settings');
        $('div.menu.mainMenu a').parent().children('.active').removeClass('active');
        $('div.pusher div.ui.segment div.information h1.ui.header.plant_header').html(_.capitalize('Global Settings'));
        $('div.iopheader div.ui.menu.secondary').css('display', 'none');
      });
      request.fail(function(jqXHR, textStatus) {
        $('section.mainContent').html('Request failed:' + textStatus);
      });
      window.history.pushState({}, '', '/global/settings');
    });
    $('a.item.plant_settings').click(function(e) {
      var request;
      request = $.ajax({
        url: '/get/plant/settings',
        method: 'POST',
        data: {}
      });
      request.done(function(msg) {
        $('section.mainContent').html(msg);
        $('div.menu.mainMenu a').parent().children('.active').removeClass('active');
        sg_nsps();
      });
      request.fail(function(jqXHR, textStatus) {
        $('section.mainContent').html('Request failed:' + textStatus);
      });
      window.history.pushState({}, '', '/plant/' + getCurrentPlant() + '/settings');
    });
    $('a.item.plant').click(function(e) {
      var plant, request;
      plant = $(this).attr('class').split(' ')[2];
      request = $.ajax({
        url: '/get/plant/overview',
        method: 'POST',
        data: {
          plant: plant
        }
      });
      request.done(function(msg) {
        $('section.mainContent').fadeOut('slow', function() {
          $('section.mainContent').html(msg).fadeIn('slow');
        });
        window.history.pushState({}, '', '/plant/' + plant + '/overview');
        $('div.menu.mainMenu a').parent().children('.active').removeClass('active');
        $('div.menu.mainMenu a.overview').addClass('active');
        $('div.pusher div.ui.segment div.information h1.ui.header.plant_header').html(_.capitalize(plant));
        $('div.iopheader div.ui.menu.secondary').css('display', 'inherit');
      });
      request.fail(function(jqXHR, textStatus) {
        $('section.mainContent').html('Request failed:' + textStatus);
      });
    });
    $('a.item.sensor').click(function(e) {
      var request, sensor;
      sensor = $(this).attr('class').split(' ')[2];
      request = $.ajax({
        url: '/get/plant/sensor',
        method: 'POST',
        data: {
          sensor: sensor
        }
      });
      request.done(function(msg) {
        $('section.mainContent').html(msg);
      });
      request.fail(function(jqXHR, textStatus) {
        $('section.mainContent').html('Request failed:' + textStatus);
      });
      window.history.pushState({}, '', '/plant/' + getCurrentPlant() + '/' + sensor);
    });
    $('a.item.overview').click(function(e) {
      var request;
      request = $.ajax({
        url: '/get/plant/overview',
        method: 'POST',
        data: {}
      });
      request.done(function(msg) {
        $('section.mainContent').html(msg);
        window.history.pushState({}, '', '/plant/' + getCurrentPlant() + '/overview');
      });
      request.fail(function(jqXHR, textStatus) {
        $('section.mainContent').html('Request failed:' + textStatus);
      });
    });
  });

}).call(this);

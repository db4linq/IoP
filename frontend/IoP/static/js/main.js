(function(){var e,n,t,a,s,i,o,l,d,r,u,c,p,m,v,h,f,g,w,C,S;s=function(){var e;return e=$.ajax({url:"/get/current/plant",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),e.responseText},a=function(){var e;return e=$.ajax({url:"/get/current/p_uuid",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),e.responseText},i=function(){var e;return e=$.ajax({url:"/get/current/sensor",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),e.responseText},r=function(e,n,t,a,s){var i,o,l,d,r,u;for(i=[],o=[],u=n.predicted,d=0,r=u.length;d<r;d++)l=u[d],i.push({plant:t,sensor:a,value:l.value,timestamp:l.timestamp});e.predicted.bulkAdd(i).then(function(n){e.real.where("[plant+sensor]").equals([t,a]).sortBy("timestamp").then(function(i){var l,d;for(l=0,d=i.length;l<d;l++)n=i[l],o.push([new Date(1e3*n.timestamp),n.value,null]);return e.predicted.where("[plant+sensor]").equals([t,a]).each(function(e){o.push([new Date(1e3*e.timestamp),null,e.value])}).then(function(e){var n;smoothPlotter.smoothing=.33,n=new Dygraph(document.getElementById("graph"),o,{labels:["time",s,"prediction"],plotter:smoothPlotter,legend:"always",animatedZooms:!0})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},o=function(e){var n,t,s,o;o=i(),s=a(),t=new Dexie("sensordata"),t.version(1).stores({real:"++id, sensor, plant, timestamp, [plant+sensor]",predicted:"++id, sensor, plant, [plant+sensor]"}),t.open().catch(function(){return alert("Uh oh : "+error)}),n=-1,t.real.where("[plant+sensor]").equals([s,o]).count().then(function(n){var a,i;return i=[],console.log(n),0===n?(i=[],console.log("building indexedDB [partial]"),a=$.ajax({url:"/get/plant/sensor/data/count",method:"POST",data:{sensor:o}}),void a.done(function(n){var l,d,r,u,c,p;for(a=JSON.parse(n).count,d=0,c=0,p=0;p<a;)d+=1,c=1===d?0:p,p=Math.floor(Math.pow(d,2.8)),console.log(p-c),1===d&&(smoothPlotter.smoothing=.33,l=new Dygraph(document.getElementById("graph"),i,{labels:["time",e,"prediction"],plotter:smoothPlotter,legend:"always",animatedZooms:!0})),u=$.ajax({url:"/get/plant/sensor/data/range",method:"POST",data:{sensor:o,start:c,stop:p}}),u.done(function(e){var n,a,d,r,u;for(n=[],r=JSON.parse(e),d=0,u=r.length;d<u;d++)a=r[d],i.unshift([new Date(1e3*a.timestamp),a.value,null]),n.push({plant:s,sensor:o,value:a.value,timestamp:a.timestamp});i.sort(function(e,n){return e[0]-n[0]}),t.real.bulkAdd(n).then(function(e){l.updateOptions({file:i})}).catch(function(e){console.log(e)})});r=$.ajax({url:"/get/plant/sensor/prediction",method:"POST",data:{sensor:o}}),r.done(function(e){var n,a,d,r,u;for(r=JSON.parse(e),n=[],console.log("predicting"),d=0,u=r.length;d<u;d++)a=r[d],i.push([new Date(1e3*a.timestamp),null,a.value]),n.push({plant:s,sensor:o,value:a.value,timestamp:a.timestamp});return t.predicted.bulkAdd(n).then(function(e){l.updateOptions({file:i})})})})):(console.log("using indexedDB"),void t.real.where("[plant+sensor]").equals([s,o]).reverse().sortBy("timestamp").then(function(n){var a;n=n[0],a=$.ajax({url:"/get/plant/sensor/dataset/custom",method:"POST",data:{latest_timestamp:n.timestamp}}),a.done(function(n){var a,l,d,u,c,p;for(i=[],u=JSON.parse(n),console.log(u.real.length),a=[],p=u.real,d=0,c=p.length;d<c;d++)l=p[d],a.push({plant:s,sensor:o,value:l.value,timestamp:l.timestamp});return t.real.bulkAdd(a).then(function(n){a=[],console.log(u.predicted.length),u.predicted.length>0?t.predicted.clear().then(function(n){return console.log("terminating predicted table"),r(t,u,s,o,e)}):(console.log("continuing"),r(t,u,s,o,e))}).catch(function(e){console.log(e)})})}).catch(function(e){console.log(e)}))}).catch(function(e){console.log(e)})},window.initLineGraph=o,l=function(e){$("div.menu.mainMenu").children("."+e).addClass("active")},window.initSetTab=l,u=function(){var e;e=$.ajax({url:"/get/plant/settings/data/non_specific",method:"POST",data:{}}),e.done(function(e){e=JSON.parse(e),$("#__nsps_name input").val(e.name),$("#__nsps_type input").val(e.type),$("#__nsps_location input").val(e.location),$("#__nsps_segment").fadeIn("slow")})},window.sg_nsps=u,c=function(e){$(e).addClass("disabled"),$(e).addClass("loading"),u(),$(document).ajaxComplete(function(){return $(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_nsps_reset=c,p=function(e){var n;return $(e).addClass("disabled"),$(e).addClass("loading"),n=$.ajax({url:"/update/plant/settings/non_specific",method:"POST",data:{name:$("#__nsps_name input").val(),location:$("#__nsps_location input").val(),type:$("#__nsps_type input").val()}}),n.done(function(n){if(n=JSON.parse(n),$(e).removeClass("disabled"),$(e).removeClass("loading"),"change"===n.info)return window.location="/plant/"+n.plant+"/overview"})},window.sg_nsps_submit=p,w=function(){var e;e=$.ajax({url:"/get/plant/settings/data/sensor_ranges",method:"POST",data:{}}),e.done(function(e){var n,t,a,s,i;for(e=JSON.parse(e),t=0,a=e.length;t<a;t++)n=e[t],i=n.settings,s=$.ajax({url:"/get/sensor/range",method:"POST",data:{sensor:n.sensor},async:!1}),s.done(function(e){var n,t,a;return t=JSON.parse(e),e=t.range,a=t.sensor,n=[],n.push(i.yellow.min),n.push(i.green.min),n.push(i.green.max),n.push(i.yellow.max),$("#flat-slider-vertical-"+a).slider({max:e.max,min:e.min,values:n,orientation:"vertical"}).slider("pips",{first:"pip",last:"pip"}).slider("float")});$(".__ssps_segment").fadeIn("slow")})},window.sg_ssps=w,S=function(e){var n,t,a;$(e).addClass("disabled"),$(e).addClass("loading"),n=$(e).parent().parent().parent().attr("class").split(" ")[2].split("_")[1],a=$("#flat-slider-vertical-"+n).slider("values"),a=a.sort(function(e,n){return e-n}),$("#flat-slider-vertical-"+n).slider("values",a),t=$.ajax({url:"/update/plant/ranges",method:"POST",data:{new:a,sensor:n}}),t.done(function(n){return $(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_ssps_submit=S,C=function(e){var n,t;$(e).addClass("disabled"),$(e).addClass("loading"),n=$(e).parent().parent().parent().attr("class").split(" ")[2].split("_")[1],t=$.ajax({url:"/get/plant/sensor/ranges",method:"POST",data:{sensor:n}}),t.done(function(t){var a;t=JSON.parse(t),a=[],a.push(t.yellow.min),a.push(t.green.min),a.push(t.green.max),a.push(t.yellow.max),$("#flat-slider-vertical-"+n).slider("values",a),$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_ssps_reset=C,m=function(){var e;e=$.ajax({url:"/get/responsibles",method:"POST",data:{}}),e.done(function(e){var n,t,a,s;for(e=JSON.parse(e),t=0,a=e.length;t<a;t++)s=e[t],$("#select").append('<option value="'+s.email+'">'+s.name+"</option>");return n=$.ajax({url:"/get/plant/responsible",method:"POST",data:{}}),n.done(function(e){e=JSON.parse(e),$("#select").dropdown("set selected",e.email),$("#__rsps_input").val(e.email),$("#__rsps_segment").fadeIn("slow")})})},window.sg_rsps=m,v=function(e){$("#__rsps_input").val($(e).val())},window.sg_rsps_change=v,g=function(e){var n,t,a;$(e).addClass("disabled"),$(e).addClass("loading"),t=$("#select option:selected").text(),n=$("#__rsps_input").val(),a=$.ajax({url:"/update/plant/responsible",method:"POST",data:{name:t,email:n}}),a.done(function(n){$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_submit=g,h=function(e){var n,t,a,s;$(e).addClass("disabled"),$(e).addClass("loading"),s=$("#create_select option:selected").text(),console.log(s),t=$("#__rspsc_name").val(),n=$("#__rspsc_email").val(),a=$.ajax({url:"/create/responsible",method:"POST",data:{name:t,email:n,wizard:s}}),a.done(function(n){$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_create=h,f=function(e){var n;return $(e).addClass("disabled"),$(e).addClass("loading"),n=$.ajax({url:"/get/plant/responsible",method:"POST",data:{}}),n.done(function(n){n=JSON.parse(n),$("#select").dropdown("set selected",n.email),$("#__rsps_input").val(n.email),$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_reset=f,n=function(){var e;$("div.ui.selection.dropdown.discover > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/discover",method:"POST",data:{}}),e.done(function(e){var n,t,a;for(e=JSON.parse(e),$("div.ui.selection.dropdown.discover > div.menu").empty(),t=0,a=e.length;t<a;t++)n=e[t],n.master===!0?n.role="master":n.role="slave",console.log(n),$("div.ui.selection.dropdown.discover > div.menu").append('<div class="item '+n.role+'" data-value="'+n.ip+'"> '+n.ip+" </div>");return $("div.ui.selection.dropdown.discover > div.default.text").html("IP-Adress - done loading")})},window.device_discover=n,t=function(){var e;$("div.ui.selection.dropdown.master > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/master",method:"POST",data:{}}),e.done(function(e){var n,t,a,s;for(e=JSON.parse(e),$("div.ui.selection.dropdown.master > div.menu").empty(),a=0,s=e.length;a<s;a++)t=e[a],n=t.name+" <"+t.ip+">",$("div.ui.selection.dropdown.master > div.menu").append("<div class='item' data-value='"+t.uuid+"'>"+n+"</div>");$("div.ui.selection.dropdown.master > div.default.text").html("ready for selection")})},window.device_master=t,e=function(){var e;$("div.ui.selection.dropdown.responsible > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/responsibles",method:"POST",data:{}}),e.done(function(e){var n,t,a;for(e=JSON.parse(e),$("div.ui.selection.dropdown.responsible > div.menu").empty(),n=0,t=e.length;n<t;n++)a=e[n],$("div.ui.selection.dropdown.responsible > div.menu").append('<div class="item" data-value="'+a.email+'">'+a.name+" &lt"+a.email+"&gt </div>");return $("div.ui.selection.dropdown.responsible > div.default.text").html("Responsible - done loading")})},window.add_plant_responsibles=e,d=function(){var e,n,t,a,s,i,o,l;e=$("input.name").val(),n=$("input.location").val(),t=$("input.species").val(),s=$("input.notification_interval").val(),i=$(".ui.selection.dropdown.responsible .active.selected").data().value,o=$(".ui.selection.dropdown.discover .active.selected").data().value,l=$(".ui.selection.dropdown.master .active.selected").data(),l=void 0===l?"master":l.value,a=$.ajax({url:"/create/plant",method:"POST",data:{name:e,location:n,species:t,interval:s,email:i,ip:o,role:l}}),a.done(function(e){return window.location.href="/"})},window.register_new_plant=d,$(function(){$("a.item.add_plant").click(function(e){var n;n=$.ajax({url:"/display/add_plant/",method:"POST",data:{}}),n.done(function(e){return $("section.mainContent").fadeOut("slow",function(){$("section.mainContent").html(e),$("section.mainContent").html(e).fadeIn("slow")}),window.history.pushState({},"","/add")})}),$("div.menu.mainMenu a").click(function(e){$(this).parent().children(".active").removeClass("active"),$(this).addClass("active")}),$("a.item.global_settings").click(function(e){var n;n=$.ajax({url:"/get/general/settings",method:"POST",data:{}}),n.done(function(e){$("section.mainContent").html(e),window.history.pushState({},"","/global/settings"),$("div.menu.mainMenu a").parent().children(".active").removeClass("active"),$("div.pusher div.ui.segment div.information h1.ui.header.plant_header").html(_.capitalize("Global Settings")),$("div.iopheader div.ui.menu.secondary").css("display","none")}),n.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),window.history.pushState({},"","/global/settings")}),$("a.item.plant_settings").click(function(e){var n;n=$.ajax({url:"/get/plant/settings",method:"POST",data:{}}),n.done(function(e){$("section.mainContent").html(e),$("div.menu.mainMenu a").parent().children(".active").removeClass("active")}),n.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),window.history.pushState({},"","/plant/"+s()+"/settings")}),$("a.item.plant").click(function(e){var n,t;n=$(this).attr("class").split(" ")[2],t=$.ajax({url:"/get/plant/overview",method:"POST",data:{plant:n}}),t.done(function(e){$("section.mainContent").fadeOut("slow",function(){$("section.mainContent").html(e).fadeIn("slow")}),window.history.pushState({},"","/plant/"+n+"/overview"),$("div.menu.mainMenu a").parent().children(".active").removeClass("active"),$("div.menu.mainMenu a.overview").addClass("active"),$("div.pusher div.ui.segment div.information h1.ui.header.plant_header").html(_.capitalize(n)),$("div.iopheader div.ui.menu.secondary").css("display","inherit")}),t.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)})}),$("a.item.sensor").click(function(e){var n,t;t=$(this).attr("class").split(" ")[2],n=$.ajax({url:"/get/plant/sensor",method:"POST",data:{sensor:t}}),n.done(function(e){$("section.mainContent").html(e)}),n.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)}),window.history.pushState({},"","/plant/"+s()+"/"+t)}),$("a.item.overview").click(function(e){var n;n=$.ajax({url:"/get/plant/overview",method:"POST",data:{}}),n.done(function(e){$("section.mainContent").html(e),window.history.pushState({},"","/plant/"+s()+"/overview")}),n.fail(function(e,n){$("section.mainContent").html("Request failed:"+n)})})})}).call(this);
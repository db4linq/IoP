(function(){var add_plant_responsibles,device_discover,device_master,getCurrentPUUID,getCurrentPlant,getCurrentSensor,initLineGraph,initSetTab,register_new_plant,setuppredicted,sg_nsps,sg_nsps_reset,sg_nsps_submit,sg_rsps,sg_rsps_change,sg_rsps_create,sg_rsps_reset,sg_rsps_submit,sg_ssps,sg_ssps_reset,sg_ssps_submit;getCurrentPlant=function(){var e;return e=$.ajax({url:"/get/current/plant",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),e.responseText},getCurrentPUUID=function(){var e;return e=$.ajax({url:"/get/current/p_uuid",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),e.responseText},getCurrentSensor=function(){var e;return e=$.ajax({url:"/get/current/sensor",method:"POST",async:!1,data:{}}),e.done(function(e){}),e.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),e.responseText},setuppredicted=function(e,t,n,s,a){var i,o,l,r,d,u;for(i=[],o=[],u=t.predicted,r=0,d=u.length;r<d;r++)l=u[r],i.push({plant:n,sensor:s,value:l.value,timestamp:l.timestamp});e.predicted.bulkAdd(i).then(function(t){e.real.where("[plant+sensor]").equals([n,s]).sortBy("timestamp").then(function(i){var l,r;for(l=0,r=i.length;l<r;l++)t=i[l],o.push([new Date(1e3*t.timestamp),t.value,null]);return e.predicted.where("[plant+sensor]").equals([n,s]).each(function(e){o.push([new Date(1e3*e.timestamp),null,e.value])}).then(function(e){var t;smoothPlotter.smoothing=.33,t=new Dygraph(document.getElementById("graph"),o,{labels:["time",a,"prediction"],plotter:smoothPlotter,legend:"always",animatedZooms:!0})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},initLineGraph=function(e){var t,n,s,a;a=getCurrentSensor(),s=getCurrentPUUID(),n=new Dexie("sensordata"),n.version(1).stores({real:"++id, sensor, plant, timestamp, [plant+sensor]",predicted:"++id, sensor, plant, [plant+sensor]"}),n.open().catch(function(){return alert("Uh oh : "+error)}),t=-1,n.real.where("[plant+sensor]").equals([s,a]).count().then(function(t){var i,o;return o=[],console.log(t),0===t?(o=[],console.log("building indexedDB [partial]"),i=$.ajax({url:"/get/plant/sensor/data/count",method:"POST",data:{sensor:a}}),void i.done(function(t){var l,r,d,u,p,c;for(i=JSON.parse(t).count,r=0,p=0,c=0;c<i;)r+=1,p=1===r?0:c,c=Math.floor(Math.pow(r,2.8)),console.log(c-p),1===r&&(smoothPlotter.smoothing=.33,l=new Dygraph(document.getElementById("graph"),o,{labels:["time",e,"prediction"],plotter:smoothPlotter,legend:"always",animatedZooms:!0})),u=$.ajax({url:"/get/plant/sensor/data/range",method:"POST",data:{sensor:a,start:p,stop:c}}),u.done(function(e){var t,i,r,d,u;for(t=[],d=JSON.parse(e),r=0,u=d.length;r<u;r++)i=d[r],o.unshift([new Date(1e3*i.timestamp),i.value,null]),t.push({plant:s,sensor:a,value:i.value,timestamp:i.timestamp});o.sort(function(e,t){return e[0]-t[0]}),n.real.bulkAdd(t).then(function(e){l.updateOptions({file:o})}).catch(function(e){console.log(e)})});d=$.ajax({url:"/get/plant/sensor/prediction",method:"POST",data:{sensor:a}}),d.done(function(e){var t,i,r,d,u;for(d=JSON.parse(e),t=[],console.log("predicting"),r=0,u=d.length;r<u;r++)i=d[r],o.push([new Date(1e3*i.timestamp),null,i.value]),t.push({plant:s,sensor:a,value:i.value,timestamp:i.timestamp});return n.predicted.bulkAdd(t).then(function(e){l.updateOptions({file:o})})})})):(console.log("using indexedDB"),void n.real.where("[plant+sensor]").equals([s,a]).reverse().sortBy("timestamp").then(function(t){var i;t=t[0],i=$.ajax({url:"/get/plant/sensor/dataset/custom",method:"POST",data:{latest_timestamp:t.timestamp}}),i.done(function(t){var i,l,r,d,u,p;for(o=[],d=JSON.parse(t),console.log(d.real.length),i=[],p=d.real,r=0,u=p.length;r<u;r++)l=p[r],i.push({plant:s,sensor:a,value:l.value,timestamp:l.timestamp});return n.real.bulkAdd(i).then(function(t){i=[],console.log(d.predicted.length),d.predicted.length>0?n.predicted.clear().then(function(t){return console.log("terminating predicted table"),setuppredicted(n,d,s,a,e)}):(console.log("continuing"),setuppredicted(n,d,s,a,e))}).catch(function(e){console.log(e)})})}).catch(function(e){console.log(e)}))}).catch(function(e){console.log(e)})},window.initLineGraph=initLineGraph,initSetTab=function(e){$("div.menu.mainMenu").children("."+e).addClass("active")},window.initSetTab=initSetTab,sg_nsps=function(){var e;e=$.ajax({url:"/get/plant/settings/data/non_specific",method:"POST",data:{}}),e.done(function(e){e=JSON.parse(e),$("#__nsps_name input").val(e.name),$("#__nsps_type input").val(e.type),$("#__nsps_location input").val(e.location),$("#__nsps_segment").fadeIn("slow")})},window.sg_nsps=sg_nsps,sg_nsps_reset=function(e){$(e).addClass("disabled"),$(e).addClass("loading"),sg_nsps(),$(document).ajaxComplete(function(){return $(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_nsps_reset=sg_nsps_reset,sg_nsps_submit=function(e){var t;return $(e).addClass("disabled"),$(e).addClass("loading"),t=$.ajax({url:"/update/plant/settings/non_specific",method:"POST",data:{name:$("#__nsps_name input").val(),location:$("#__nsps_location input").val(),type:$("#__nsps_type input").val()}}),t.done(function(t){if(t=JSON.parse(t),$(e).removeClass("disabled"),$(e).removeClass("loading"),"change"===t.info)return window.location="/plant/"+t.plant+"/overview"})},window.sg_nsps_submit=sg_nsps_submit,sg_ssps=function(){var e;e=$.ajax({url:"/get/plant/settings/data/sensor_ranges",method:"POST",data:{}}),e.done(function(e){var t,n,s,a,i;for(e=JSON.parse(e),n=0,s=e.length;n<s;n++)t=e[n],i=t.settings,a=$.ajax({url:"/get/sensor/range",method:"POST",data:{sensor:t.sensor},async:!1}),a.done(function(e){var t,n,s;return n=JSON.parse(e),e=n.range,s=n.sensor,t=[],t.push(i.yellow.min),t.push(i.green.min),t.push(i.green.max),t.push(i.yellow.max),$("#flat-slider-vertical-"+s).slider({max:e.max,min:e.min,values:t,orientation:"vertical"}).slider("pips",{first:"pip",last:"pip"}).slider("float")});$(".__ssps_segment").fadeIn("slow")})},window.sg_ssps=sg_ssps,sg_ssps_submit=function(e){var t,n,s;$(e).addClass("disabled"),$(e).addClass("loading"),t=$(e).parent().parent().parent().attr("class").split(" ")[2].split("_")[1],s=$("#flat-slider-vertical-"+t).slider("values"),s=s.sort(function(e,t){return e-t}),$("#flat-slider-vertical-"+t).slider("values",s),n=$.ajax({url:"/update/plant/ranges",method:"POST",data:{new:s,sensor:t}}),n.done(function(t){return $(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_ssps_submit=sg_ssps_submit,sg_ssps_reset=function(e){var t,n;$(e).addClass("disabled"),$(e).addClass("loading"),t=$(e).parent().parent().parent().attr("class").split(" ")[2].split("_")[1],n=$.ajax({url:"/get/plant/sensor/ranges",method:"POST",data:{sensor:t}}),n.done(function(n){var s;n=JSON.parse(n),s=[],s.push(n.yellow.min),s.push(n.green.min),s.push(n.green.max),s.push(n.yellow.max),$("#flat-slider-vertical-"+t).slider("values",s),$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_ssps_reset=sg_ssps_reset,sg_rsps=function(){var e;e=$.ajax({url:"/get/responsibles",method:"POST",data:{}}),e.done(function(e){var t,n,s,a;for(e=JSON.parse(e),n=0,s=e.length;n<s;n++)a=e[n],$("#select").append('<option value="'+a.email+'">'+a.name+"</option>");return t=$.ajax({url:"/get/plant/responsible",method:"POST",data:{}}),t.done(function(e){e=JSON.parse(e),$("#select").dropdown("set selected",e.email),$("#__rsps_input").val(e.email),$("#__rsps_segment").fadeIn("slow")})})},window.sg_rsps=sg_rsps,sg_rsps_change=function(e){$("#__rsps_input").val($(e).val())},window.sg_rsps_change=sg_rsps_change,sg_rsps_submit=function(e){var t,n,s;$(e).addClass("disabled"),$(e).addClass("loading"),n=$("#select option:selected").text(),t=$("#__rsps_input").val(),s=$.ajax({url:"/update/plant/responsible",method:"POST",data:{name:n,email:t}}),s.done(function(t){$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_submit=sg_rsps_submit,sg_rsps_create=function(e){var t,n,s,a;$(e).addClass("disabled"),$(e).addClass("loading"),a=$("#create_select option:selected").text(),console.log(a),n=$("#__rspsc_name").val(),t=$("#__rspsc_email").val(),s=$.ajax({url:"/create/responsible",method:"POST",data:{name:n,email:t,wizard:a}}),s.done(function(t){$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_create=sg_rsps_create,sg_rsps_reset=function(e){var t;return $(e).addClass("disabled"),$(e).addClass("loading"),t=$.ajax({url:"/get/plant/responsible",method:"POST",data:{}}),t.done(function(t){t=JSON.parse(t),$("#select").dropdown("set selected",t.email),$("#__rsps_input").val(t.email),$(e).removeClass("disabled"),$(e).removeClass("loading")})},window.sg_rsps_reset=sg_rsps_reset,device_discover=function(){var e;$("div.ui.selection.dropdown.discover > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/discover",method:"POST",data:{}}),e.done(function(e){var t,n,s;for(e=JSON.parse(e),$("div.ui.selection.dropdown.discover > div.menu").empty(),n=0,s=e.length;n<s;n++)t=e[n],t.master===!0?t.role="master":t.role="slave",console.log(t),$("div.ui.selection.dropdown.discover > div.menu").append('<div class="item '+t.role+'" data-value="'+t.ip+'"> '+t.ip+" </div>");return $("div.ui.selection.dropdown.discover > div.default.text").html("IP-Adress - done loading")})},window.device_discover=device_discover,device_master=function(){var e;$("div.ui.selection.dropdown.master > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/master",method:"POST",data:{}}),e.done(function(e){var t,n,s,a;for(e=JSON.parse(e),$("div.ui.selection.dropdown.master > div.menu").empty(),s=0,a=e.length;s<a;s++)n=e[s],t=n.name+" <"+n.ip+">",$("div.ui.selection.dropdown.master > div.menu").append("<div class='item' data-value='"+n.uuid+"'>"+t+"</div>");$("div.ui.selection.dropdown.master > div.default.text").html("ready for selection")})},window.device_master=device_master,add_plant_responsibles=function(){var e;$("div.ui.selection.dropdown.responsible > div.default.text").html("please wait a couple of seconds"),e=$.ajax({url:"/get/responsibles",method:"POST",data:{}}),e.done(function(e){var t,n,s;for(e=JSON.parse(e),$("div.ui.selection.dropdown.responsible > div.menu").empty(),t=0,n=e.length;t<n;t++)s=e[t],$("div.ui.selection.dropdown.responsible > div.menu").append('<div class="item" data-value="'+s.email+'">'+s.name+" &lt"+s.email+"&gt </div>");return $("div.ui.selection.dropdown.responsible > div.default.text").html("Responsible - done loading")})},window.add_plant_responsibles=add_plant_responsibles,register_new_plant=function(){var e,t,n,s,a,i,o,l;e=$("input.name").val(),t=$("input.location").val(),n=$("input.species").val(),a=$("input.notification_interval").val(),i=$(".ui.selection.dropdown.responsible .active.selected").data().value,o=$(".ui.selection.dropdown.discover .active.selected").data().value,l=$(".ui.selection.dropdown.master .active.selected").data(),l=void 0===l?"master":l.value,s=$.ajax({url:"/create/plant",method:"POST",data:{name:e,location:t,species:n,interval:a,email:i,ip:o,role:l}}),s.done(function(e){return window.location.href="/"})},window.register_new_plant=register_new_plant,$(function(){$("a.item.add_plant").click(function(e){var t;t=$.ajax({url:"/display/add_plant/",method:"POST",data:{}}),t.done(function(e){return $("section.mainContent").fadeOut("slow",function(){$("section.mainContent").html(e),$("section.mainContent").html(e).fadeIn("slow")}),window.history.pushState({},"","/add")})}),$("div.menu.mainMenu a").click(function(e){$(this).parent().children(".active").removeClass("active"),$(this).addClass("active")}),$("a.item.global_settings").click(function(e){var t;t=$.ajax({url:"/get/general/settings",method:"POST",data:{}}),t.done(function(e){$("section.mainContent").html(e),window.history.pushState({},"","/global/settings"),$("div.menu.mainMenu a").parent().children(".active").removeClass("active"),$("div.pusher div.ui.segment div.information h1.ui.header.plant_header").html(_.capitalize("Global Settings")),$("div.iopheader div.ui.menu.secondary").css("display","none")}),t.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),window.history.pushState({},"","/global/settings")}),$("a.item.manage").click(function(e){var t;t=$.ajax({url:"/get/manage/template",method:"POST"}),t.done(function(e){$("section.mainContent").html(e),window.history.pushState({},"","/manage"),$("div.menu.mainMenu a").parent().children(".active").removeClass("active"),$("div.pusher div.ui.segment div.information h1.ui.header.plant_header").html(_.capitalize("Global Settings")),$("div.iopheader div.ui.menu.secondary").css("display","none")}),t.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),window.history.pushState({},"","/manage")}),$("a.item.plant_settings").click(function(e){var request;request=$.ajax({url:"/get/plant/settings",method:"POST",data:{}}),request.done(function(msg){$("section.mainContent").html(msg),eval(msg),$("div.menu.mainMenu a").parent().children(".active").removeClass("active")}),request.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),window.history.pushState({},"","/plant/"+getCurrentPlant()+"/settings")}),$("a.item.plant").click(function(e){var t,n;t=$(this).attr("class").split(" ")[2],n=$.ajax({url:"/get/plant/overview",method:"POST",data:{plant:t}}),n.done(function(e){$("section.mainContent").fadeOut("slow",function(){$("section.mainContent").html(e).fadeIn("slow")}),window.history.pushState({},"","/plant/"+t+"/overview"),$("div.menu.mainMenu a").parent().children(".active").removeClass("active"),$("div.menu.mainMenu a.overview").addClass("active"),$("div.pusher div.ui.segment div.information h1.ui.header.plant_header").html(_.capitalize(t)),$("div.iopheader div.ui.menu.secondary").css("display","inherit")}),n.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)})}),$("a.item.sensor").click(function(e){var request,sensor;sensor=$(this).attr("class").split(" ")[2],request=$.ajax({url:"/get/plant/sensor",method:"POST",data:{sensor:sensor}}),request.done(function(msg){$("section.mainContent").html(msg),eval(msg)}),request.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)}),window.history.pushState({},"","/plant/"+getCurrentPlant()+"/"+sensor)}),$("a.item.overview").click(function(e){var t;t=$.ajax({url:"/get/plant/overview",method:"POST",data:{}}),t.done(function(e){$("section.mainContent").html(e),window.history.pushState({},"","/plant/"+getCurrentPlant()+"/overview")}),t.fail(function(e,t){$("section.mainContent").html("Request failed:"+t)})})})}).call(this);